<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Integration - FantaAiuto</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ccc; border-radius: 8px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        button { padding: 10px 15px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        #results { margin-top: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>üß™ Test Integration FantaAiuto</h1>
    <p>Questa pagina testa le funzionalit√† integrate dal codice estratto</p>

    <div class="test-section info">
        <h2>üìã Test Excel Manager</h2>
        <button onclick="testExcelManager()">Test Excel Manager</button>
        <button onclick="testFileFromResources()">Test con File Excel da Resources</button>
    </div>

    <div class="test-section info">
        <h2>üì∏ Test Image Manager</h2>
        <button onclick="testImageManager()">Test Image Manager</button>
    </div>

    <div class="test-section info">
        <h2>üë• Test Player Manager Avanzato</h2>
        <button onclick="testAdvancedPlayerManager()">Test Player Manager Avanzato</button>
    </div>

    <div class="test-section info">
        <h2>üéØ Test Modalit√† Import</h2>
        <button onclick="testImportModes()">Test Modalit√† Import</button>
    </div>

    <div id="results"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script type="module">
        import { FantaAiutoApp } from './src/components/App.js';

        let app;
        
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                app = new FantaAiutoApp();
                await app.init();
                addResult('‚úÖ App inizializzata con successo', 'success');
            } catch (error) {
                addResult(`‚ùå Errore inizializzazione app: ${error.message}`, 'error');
                console.error('App initialization error:', error);
            }
        });

        function addResult(message, type) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.textContent = message;
            results.appendChild(div);
        }

        window.testExcelManager = async () => {
            try {
                const excelService = app.services?.excel;
                if (!excelService) {
                    throw new Error('Excel manager non inizializzato');
                }
                
                addResult('‚úÖ Excel Manager disponibile', 'success');
                addResult(`üìä XLSX Library: ${typeof XLSX !== 'undefined' ? 'Caricata' : 'Non trovata'}`, 
                    typeof XLSX !== 'undefined' ? 'success' : 'error');
                
            } catch (error) {
                addResult(`‚ùå Test Excel Manager fallito: ${error.message}`, 'error');
            }
        };

        window.testFileFromResources = async () => {
            try {
                // Simula il test con dati mock basati sulla struttura Excel
                const mockExcelData = [
                    [1, 'Por', 'Por', 'Maignan', 'Milan', '', '', '', '', '', '', '', 25.5],
                    [2, 'Ds;Dd', 'Ds;Dd', 'Theo Hernandez', 'Milan', '', '', '', '', '', '', '', 22.3],
                    [3, 'A;Pc', 'A;Pc', 'Osimhen', 'Napoli', '', '', '', '', '', '', '', 28.1]
                ];

                const playerService = app.services?.players;
                if (!playerService) {
                    throw new Error('Player manager non inizializzato');
                }

                // Test processamento dati Excel
                const excelService = app.services.excel;
                const processedPlayers = excelService.processPlayerData(mockExcelData);
                
                addResult(`‚úÖ Processati ${processedPlayers.length} giocatori dal mock Excel`, 'success');
                
                // Test import con modalit√† FVM
                const imported = await playerService.importPlayersWithFVMDistribution(processedPlayers);
                addResult(`‚úÖ Importati ${imported} giocatori con distribuzione FVM`, 'success');
                
                // Test statistiche
                const stats = playerService.getStats();
                addResult(`üìä Stats: ${stats.playersOwned} posseduti, budget: ${stats.budgetRemaining}`, 'info');
                
            } catch (error) {
                addResult(`‚ùå Test file resources fallito: ${error.message}`, 'error');
                console.error('Test error:', error);
            }
        };

        window.testImageManager = async () => {
            try {
                const imageService = app.services?.images;
                if (!imageService) {
                    throw new Error('Image manager non inizializzato');
                }
                
                addResult('‚úÖ Image Manager disponibile', 'success');
                
                const images = imageService.getImages();
                addResult(`üì∏ Immagini caricate: ${images.length}`, 'info');
                
            } catch (error) {
                addResult(`‚ùå Test Image Manager fallito: ${error.message}`, 'error');
            }
        };

        window.testAdvancedPlayerManager = async () => {
            try {
                const playerService = app.services?.players;
                if (!playerService) {
                    throw new Error('Player manager non inizializzato');
                }

                // Test metodi avanzati
                const ownedPlayers = playerService.getOwnedPlayers();
                const interestingPlayers = playerService.getInterestingPlayers();
                const removedPlayers = playerService.getRemovedPlayers();
                
                addResult(`üë• Giocatori posseduti: ${ownedPlayers.length}`, 'info');
                addResult(`‚≠ê Giocatori interessanti: ${interestingPlayers.length}`, 'info');
                addResult(`üóëÔ∏è Giocatori rimossi: ${removedPlayers.length}`, 'info');
                
                // Test raccomandazioni
                const recommendations = playerService.getRecommendations();
                addResult(`üí° Raccomandazioni disponibili: ${recommendations.length}`, 'info');
                
                addResult('‚úÖ Player Manager avanzato funzionante', 'success');
                
            } catch (error) {
                addResult(`‚ùå Test Advanced Player Manager fallito: ${error.message}`, 'error');
            }
        };

        window.testImportModes = async () => {
            try {
                const excelService = app.services?.excel;
                const playerService = app.services?.players;
                
                if (!excelService || !playerService) {
                    throw new Error('Servizi non inizializzati');
                }

                // Test modalit√† import
                const mockPlayers = [
                    {
                        id: 'test1',
                        nome: 'Test Player 1',
                        ruoli: ['Por'],
                        squadra: 'Test FC',
                        fvm: 15.5,
                        prezzo: 4,
                        status: 'available'
                    },
                    {
                        id: 'test2', 
                        nome: 'Test Player 2',
                        ruoli: ['A'],
                        squadra: 'Test FC',
                        fvm: 1,  // Questo verr√† rimosso nei test con rimozione
                        prezzo: 1,
                        status: 'available'
                    }
                ];

                // Test modalit√† 1: FVM distribution
                await playerService.importPlayersWithFVMDistribution([...mockPlayers]);
                let stats = playerService.getStats();
                addResult(`‚úÖ Modalit√† 1 - Giocatori importati: ${app.appData.players.length}`, 'success');

                // Test modalit√† 2: FVM distribution con rimozione
                await playerService.importPlayersWithFVMDistributionAndRemoval([...mockPlayers]);
                stats = playerService.getStats();
                addResult(`‚úÖ Modalit√† 2 - Giocatori dopo rimozione FVM=1: ${app.appData.players.length}`, 'success');

                // Test modalit√† 3: Tutti in Non inseriti
                await playerService.importPlayersToNonInseriti([...mockPlayers]);
                stats = playerService.getStats();
                addResult(`‚úÖ Modalit√† 3 - Tutti in Non inseriti: ${app.appData.players.length}`, 'success');

                addResult('‚úÖ Tutte le modalit√† di import testate con successo', 'success');
                
            } catch (error) {
                addResult(`‚ùå Test modalit√† import fallito: ${error.message}`, 'error');
            }
        };
    </script>
</body>
</html>